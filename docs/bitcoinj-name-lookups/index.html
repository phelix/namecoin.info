<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>BitcoinJ Namecoin Name Lookup Client</title>
    <!--<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">-->

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
    /* Work in progress, created by Ben <dotbitgod@gmail.com>. */

body {
    background: #F7F7F7;
    background: #292e3c;
    font-size: 18px;
    font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
    word-wrap: break-word;
}

body > header {
    background: #999;
}

.lead {
    font-size: 1.9em;
}

h2 {
    font-size: 1.2em;
    font-weight: bold;
    color: #495f7e;
}

body > footer {
    background: #292e3c url(/images/fancy.jpg) center bottom;
    height: 99px;
}

body > footer > .container, body > footer > .container-fluid {
    opacity: 0.6;
    padding-top: 33px;
}


body > footer a, body > footer a:hover {
    color: #FFF;
}

nav ul li {
    display: inline;
}

#fancy-graphic {
    height: 350px;
    background: #292e3c url(/images/fancy.jpg) center top fixed;
    padding-top: 125px;
}

#fancy-graphic p {
    font-size: 4em;
    font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
    color: #FFF;
    margin: 0;
    line-height: 1;
    text-shadow: 1px 1px 1px #000;
    opacity: 0.6;
    position: fixed;
    z-index: 0;
}

@media (max-width: 549px) {
  #fancy-graphic {
    height: 262.5px;
    padding-top: 93.75px;
  }
  
  #fancy-graphic p {
    font-size: 3em;
  }
}

@media (max-width: 399px) {
  #fancy-graphic {
    height: 218.75px;
    padding-top: 78.125px;
  }
  
  #fancy-graphic p {
    font-size: 2.5em;
  }
}

#content {
    position: relative;
    z-index: 9;
    background: #F7F7F7;
    padding: 40px;
}

table {
    border-collapse: collapse;
}

td, th {
    border: 1px solid #999;
    padding: 0.5em;
}

*[id]:before {
    display: block;
    content: " ";
    margin-top: -51px;
    height: 51px;
    visibility: hidden;
}

/* TODO: refactor this */
@media (max-width: 1003px) and (min-width: 768px) {
    *[id]:before {
        display: block;
        content: " ";
        margin-top: -101px;
        height: 101px;
        visibility: hidden;
    }
}

    </style>
    
    <link rel="canonical" href="https://namecoin.org//docs/bitcoinj-name-lookups/">
</head>


  <body>

    <header class="site-header">

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                     <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                      </button>
                      <a class="navbar-brand" href="/"><img src="/images/logo.png" alt="Namecoin" /></a>
                </div>
                <div class="navbar-collapse collapse" id="navbar-collapse">
                <ul class="nav navbar-nav navbar-left">
                    <li><a href="/">Home</a></li>
                    <li><a href="/exchanges/">Exchanges</a></li>
                    <li><a href="/team/">Team</a></li>
                    <li><a href="/explorers/">Explorers</a></li>
                    <li><a href="/download/"><!--span class="glyphicon glyphicon-download-alt"></span--> Download</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://forum.namecoin.info">Forum&#10138;</a></li>
                    <li><a href="https://wiki.namecoin.info">Wiki&#10138;</a></li>
                    <li><a href="/docs/faq/">FAQ</a></li>
                    <li><a href="https://github.com/namecoin/meta/blob/master/roadmap.md">Roadmap&#10138;</a></li>
                </ul>
                </div>
            </div>
        </nav>

</header>

<div id="fancy-graphic"><div class="container-fluid"><p>
<script type="text/javascript">
var taglines = [
    '<strong>In information</strong><br />we <strong>trust</strong>.',
    'A <strong>trust anchor</strong><br />for the Internet.',
    '<strong>Against<br />censorship.</strong>',
    '<strong>Supporting<br />free speech.</strong>',
    'Decentralized<br /><strong>secure</strong> names.',
    '<b>Decentralize</b><br>all the things!',
    '<b>Freedom</b><br>of information.'
    ];
var rand = taglines[Math.floor(Math.random() * taglines.length)];
document.write(rand);
</script>
</p></div></div>


    <div id="content">
      <div class="container-fluid">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">BitcoinJ Namecoin Name Lookup Client</h1>
  </header>

  <article class="post-content">
    
<p>This is documentation for the BitcoinJ-based name lookup client by Namecoin’s Lead Application Engineer Jeremy Rand.  It is based on the following pre-existing projects:</p>

<ul>
  <li>libdohj by Ross Nicoll</li>
  <li>bitcoinj-addons by Sean Gilligan</li>
  <li>Webbtc by Marius Hanne</li>
</ul>

<p><strong>Warning: this is beta software, and is not suitable for production use.  It is being made available for testing purposes only.  It doesn’t support proxying or stream isolation.  In the examples on this page, we explicitly pass command-line arguments telling the client that this is okay.  Leaving off those arguments will result in an error for safety reasons.</strong></p>

<h2 id="build-prerequisites">Build prerequisites</h2>

<p>(This is only if you want to build from source.)</p>

<h3 id="gnulinux">GNU/Linux</h3>

<ol>
  <li>Install OpenJDK from your package repositories.  These instructions will be updated later with specific package names.  Development was done with JDK 8; JDK 7 might work but is untested.</li>
  <li>Make sure that the <code>JAVA_HOME</code> environment variable is set.  On Jeremy’s Debian Jessie VM, he had to manually set it to <code>/usr/lib/jvm/java-8-openjdk-amd64</code>.</li>
  <li>Install Maven from your package repositories.  These instructions will be updated later with specific package names.</li>
</ol>

<h3 id="windows">Windows</h3>

<ol>
  <li>Install JDK.  Note that Oracle’s download site doesn’t support TLS.  If you enjoy being MITM-attacked and installing malware, you can <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">download it here (non-TLS link)</a>.</li>
  <li>Make sure that the <code>JAVA_HOME</code> environment variable is set.  On Jeremy’s Windows 10 VM, he had to manually set it to <code>C:\Program Files\Java\jdk1.8.0_101</code>.</li>
  <li>Install Maven.  Note that Maven’s official download site uses non-TLS downloads (insecure), MD5 checksums (insecure), and 1024-bit DSA signing keys (insecure).  If you enjoy being MITM-attacked and installing malware, you can use the <a href="https://maven.apache.org/download.cgi">Maven download page</a> and the <a href="https://maven.apache.org/install.html">Maven install page</a>.</li>
</ol>

<p>For those of you who <em>don’t</em> enjoy installing malware, we suggest building from source on GNU/Linux and copying the binary to Windows.</p>

<h3 id="os-x">OS X</h3>

<p>No idea.  If anyone can contribute instructions for OS X, let us know.</p>

<h2 id="build-instructions">Build instructions</h2>

<p>(This is only if you want to build from source.)</p>

<p>There are 2 different branches available.  A partially-stable branch uses Dogecoin’s upstream version of libdohj.  A bleeding-edge branch uses a modified fork of libdohj that is not yet upstreamed.  Neither branch should be considered stable, since they are both using a modified fork of bitcoinj-addons that is not yet upstreamed.  Test reports against the bleeding-edge branch are likely to be more useful.  <strong>Trying to install both branches on the same machine is likely to cause problems unless the Gradle caches are entirely cleared when switching between them.</strong></p>

<p>For the partially stable branch:</p>

<pre><code>git clone https://github.com/dogecoin/libdohj.git
cd libdohj
mvn clean install
cd namecoin
mvn clean install
cd ../..
git clone https://github.com/JeremyRand/bitcoinj-addons.git
cd bitcoinj-addons
git checkout getd4-draft
./gradlew clean :bitcoinj-daemon:assemble
</code></pre>

<p>For the bleeding-edge branch:</p>

<pre><code>git clone https://github.com/JeremyRand/libdohj.git
cd libdohj
git checkout namecoin-local-lookup-2
mvn clean install
cd namecoin
mvn clean install
cd ../..
git clone https://github.com/JeremyRand/bitcoinj-addons.git
cd bitcoinj-addons
git checkout getd4-draft-local-lookup-2
./gradlew clean :bitcoinj-daemon:assemble
</code></pre>

<p>For either branch, the binary will be created at <code>bitcoinj-daemon/build/libs/bitcoinj-daemon-0.1.1-SNAPSHOT.jar</code>.</p>

<h2 id="running-it">Running it</h2>

<p><strong>All API elements that are not directly taken from Namecoin Core (including all command-line arguments and all URL formats and JSON structures for the upstream REST API) are not guaranteed to have a stable API; they might be renamed, modified, or removed in the future.</strong></p>

<pre><code>java -jar ./bitcoinj-daemon-0.1.1-SNAPSHOT.jar --connection.proxyenabled=false --connection.streamisolation=false
</code></pre>

<p>The blockchain takes around 5 minutes to download.  Once it is fully synchronized, the RPC server will automatically start; it listens on port 8080.</p>

<p>You can also customize the behavior of the server with some command line options:</p>

<pre><code>--server.port=&lt;port&gt; (default: 8080)
</code></pre>

<p>Change what port the RPC server listens on.</p>

<pre><code>--namelookup.latest.algo=&lt;algo&gt; (default: restmerkleapi)
</code></pre>

<p>Change how <code>name_show</code> lookups are performed.  The following algorithms are available:</p>

<ul>
  <li><code>restheightapi</code>: <strong>Don’t use this, it’s broken in the current version.</strong> Looks up the height of the latest <code>name_anyupdate</code> operation for the name that has at least 12 confirmations by using a REST API (default URL is <code>https://namecoin.webbtc.com/name/heights/&lt;name&gt;.json?raw</code>), and retrieves that block over the P2P network.  This is usually fast, but if the name is part of a very large block, it can take a couple of seconds.  It reveals to the REST API which name is being looked up, and it reveals to a P2P peer what the height of that name is.  The REST API can hide recent <code>name_anyupdate</code> operations without being detected.</li>
  <li><code>restmerkleapi</code>: Looks up a merkle proof for the latest <code>name_anyupdate</code> operation for the name that has at least 12 confirmations by using a REST API (default URL is <code>https://namecoin.webbtc.com/name/&lt;name&gt;.json?history&amp;with_height&amp;with_rawtx&amp;with_mrkl_branch&amp;with_tx_idx&amp;raw</code>).  This is slower than <code>restheightapi</code> for most names, but it’s faster than <code>restheightapi</code> if the name is in a very large block.  It reveals to the REST API which name is being looked up; it doesn’t reveal anything to the P2P network.  The REST API can hide recent <code>name_anyupdate</code> operations without being detected.</li>
  <li><code>restmerkleapisingle</code>: <strong>Unreliable in the current version.</strong> Similar to <code>restmerkleapi</code>, but increases lookup speed by asking the REST API to only generate a merkle proof for the most recent <code>name_anyupdate</code> operation for the name (default URL is <code>https://namecoin.webbtc.com/name/&lt;name&gt;.json?with_height&amp;with_rawtx&amp;with_mrkl_branch&amp;with_tx_idx&amp;raw</code>).  Faster than <code>restmerkleapi</code>, but will return an error if the name’s most recent update has between 1 and 11 confirmations (inclusive).  The REST API can hide recent <code>name_anyupdate</code> operations without being detected.</li>
  <li><code>leveldbtxcache</code>: <strong>Only available on bleeding-edge branch.</strong> Maintains a cache of all unexpired <code>name_anyupdate</code> operations, obtained by downloading full blocks (instead of just headers) for all blocks that are newer than 366 days old.  Much, much faster lookups than the REST-API-based algos, and lookups don’t generate any network traffic (so lookup operations are as private as Namecoin Core).  Initial syncup will take somewhat longer, and approximately 412 MB of extra storage will be used for the name database.  It is not feasible for <code>name_anyupdate</code> operations to be hidden without detection, because full blocks are downloaded.  There are known hypothetical attacks possible involving reorganizations deeper than 12 blocks; see the libdohj source code comments for details.</li>
</ul>

<pre><code>--namelookup.latest.resturlprefix=&lt;prefix&gt;
--namelookup.latest.resturlsuffix=&lt;suffix&gt;
</code></pre>

<p>Change what REST API URL is constructed; default depends on the value of <code>--namelookup.latest.algo</code>.  The URL is constructed by concatenating the prefix, the name, and the suffix.</p>

<h2 id="using-it">Using it</h2>

<h3 id="namecoin-cli">namecoin-cli</h3>

<p><strong>All API elements that are not directly taken from Namecoin Core (including the <code>valueParsed</code> field and <code>name_show_at_height</code> method) are not guaranteed to have a stable API; they might be renamed, modified, or removed in the future.</strong></p>

<p>You can use the namecoin-cli tool that comes with Namecoin Core to look up names.  Make sure that you’re using the correct port.  Any username and password are okay.</p>

<p>The following RPC commands are supported:</p>

<pre><code>name_show &lt;name&gt;
</code></pre>

<p>Similar to <code>name_show</code> provided by Namecoin Core.  Does not show a result for expired names.  Uses the algorithm specified by <code>--namelookup.latest.algo</code>.  As of this writing, the <code>vout</code> and <code>expired</code> fields normally provided by Namecoin Core are not supported (they are always null).  If the <code>value</code> field is valid as a JSON object, it will be parsed and made available as a JSON object in the <code>valueParsed</code> field.</p>

<pre><code>name_show_at_height &lt;name&gt; &lt;height&gt;
</code></pre>

<p>Similar to <code>name_show</code>, but displays the <code>name_anyupdate</code> operation from the given block height, even if it isn’t the latest <code>name_anyupdate</code> operation for that name.  Does not show a result for expired operations.  Does not show a result if the specified block doesn’t contain a <code>name_anyupdate</code> operation for the specified name.  The algorithm always retrieves the block over the P2P network.  Usually faster than <code>name_show</code>, unless <code>--namelookup.latest.algo=leveldbtxcache</code> is set.  It reveals to a P2P peer which block height is being looked up; it doesn’t reveal anything to a REST API.</p>

<p>Example usage:</p>

<pre><code>./namecoin-cli -rpcport=8080 -rpcuser=user -rpcpassword=pass name_show d/domob
</code></pre>

<h3 id="curl">curl</h3>

<p>If you don’t have namecoin-cli, any JSON-RPC client should work.  For example, you can use curl:</p>

<pre><code>curl --user user:pass --data-binary '{"jsonrpc":"1.0","id":"curltext","method":"name_show","params":["d/domob"]}' -H 'content-type:text/plain;' http://127.0.0.1:8080
</code></pre>

<h3 id="ncdns">ncdns</h3>

<p>ncdns should work as long as it’s set to the correct port.  For example, you might set the following line in <code>ncdns.conf</code>:</p>

<pre><code>namecoinrpcaddress="127.0.0.1:8080"
</code></pre>

<p>However, note that <code>--namelookup.latest.algo=leveldbtxcache</code> will be more reliable on many setups than the other algorithms, because of DNS timeouts.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

        <div class="container-fluid" style="float:left;">
            <ul class="list-inline">
                <li><a href="https://github.com/namecoin"><i class="fa fa-github fa-2x" title="GitHub">GitHub</i></a></li>
                <li><a href="https://twitter.com/Namecoin"><i class="fa fa-twitter fa-2x" title="Twitter">Twitter</i></a></li>
                <li><a href="https://www.facebook.com/Namecoin.bit"><i class="fa fa-facebook fa-2x" title="Facebook">Facebook</i></a></li>
                <li><a href="https://pay.reddit.com/r/namecoin"><i class="fa fa-users fa-2x" title="Reddit">Reddit</i></a></li>
            </ul>
        </div>

        <div class="container-fluid" style="float:right;">
	    <a href="https://github.com/namecoin/namecoin.org/blob/master/docs/bitcoinj-name-lookups/index.md"><i>Submit corrections or improvements to this page</i></a>
        </div>

        <script src="/js/jquery-1.11.0.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/script.js"></script>
        
</footer>


  </body>

</html>
